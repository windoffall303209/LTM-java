<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - Auction System</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" />
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="/admin">
          üëë Admin Panel
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto">
            <li class="nav-item">
              <a class="nav-link active" href="/admin">
                <i class="bi bi-speedometer2"></i> Dashboard
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin/auctions">
                <i class="bi bi-hammer"></i> Qu·∫£n l√Ω ƒê·∫•u Gi√°
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin/users">
                <i class="bi bi-people"></i> Qu·∫£n l√Ω Ng∆∞·ªùi D√πng
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/dashboard">
                <i class="bi bi-arrow-left"></i> V·ªÅ Dashboard
              </a>
            </li>
          </ul>
          <ul class="navbar-nav">
            <li class="nav-item">
              <span class="nav-link">
                üë§ <strong th:text="${currentUser.username}">Admin</strong>
                <span class="badge bg-warning text-dark ms-1">ADMIN</span>
              </span>
            </li>
            <li class="nav-item">
              <form
                method="POST"
                th:action="@{/api/auth/logout}"
                style="display: inline"
              >
                <button type="submit" class="btn btn-outline-light btn-sm">
                  ƒêƒÉng xu·∫•t
                </button>
              </form>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container-fluid py-4">
      <h2 class="mb-4">üìä T·ªïng Quan H·ªá Th·ªëng</h2>

      <!-- Statistics Cards -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="card bg-primary text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="card-title mb-0">T·ªïng Ng∆∞·ªùi D√πng</h6>
                  <h2 class="mb-0" id="totalUsers">0</h2>
                </div>
                <i class="bi bi-people fs-1"></i>
              </div>
              <small id="activeUsersText">0 ƒëang ho·∫°t ƒë·ªông</small>
            </div>
          </div>
        </div>

        <div class="col-md-3">
          <div class="card bg-success text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="card-title mb-0">ƒê·∫•u Gi√° Ho·∫°t ƒê·ªông</h6>
                  <h2 class="mb-0" id="activeAuctions">0</h2>
                </div>
                <i class="bi bi-hammer fs-1"></i>
              </div>
              <small id="totalAuctionsText">0 t·ªïng</small>
            </div>
          </div>
        </div>

        <div class="col-md-3">
          <div class="card bg-warning text-dark">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="card-title mb-0">ƒê·∫•u Gi√° K·∫øt Th√∫c</h6>
                  <h2 class="mb-0" id="endedAuctions">0</h2>
                </div>
                <i class="bi bi-check-circle fs-1"></i>
              </div>
              <small>Ho√†n th√†nh</small>
            </div>
          </div>
        </div>

        <div class="col-md-3">
          <div class="card bg-info text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="card-title mb-0">T·ªïng Gi√° Tr·ªã</h6>
                  <h3 class="mb-0" id="totalValue">0 VND</h3>
                </div>
                <i class="bi bi-currency-dollar fs-1"></i>
              </div>
              <small>Gi√° tr·ªã ƒë·∫•u gi√°</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="row mb-4">
        <div class="col-md-12">
          <div class="card">
            <div class="card-header bg-dark text-white">
              <h5 class="mb-0">
                <i class="bi bi-lightning-fill"></i> Thao T√°c Nhanh
              </h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-4">
                  <a href="/admin/auctions" class="btn btn-primary w-100 mb-2">
                    <i class="bi bi-plus-circle"></i> T·∫°o ƒê·∫•u Gi√° M·ªõi
                  </a>
                </div>
                <div class="col-md-4">
                  <a href="/admin/users" class="btn btn-info w-100 mb-2">
                    <i class="bi bi-people"></i> Qu·∫£n L√Ω Ng∆∞·ªùi D√πng
                  </a>
                </div>
                <div class="col-md-4">
                  <button class="btn btn-success w-100 mb-2" onclick="refreshData()">
                    <i class="bi bi-arrow-clockwise"></i> L√†m M·ªõi D·ªØ Li·ªáu
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Auctions -->
      <div class="row mb-4">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0">
                <i class="bi bi-hammer"></i> ƒê·∫•u Gi√° Ho·∫°t ƒê·ªông
              </h5>
            </div>
            <div class="card-body" style="max-height: 400px; overflow-y: auto">
              <div id="activeAuctionsList">
                <p class="text-muted">ƒêang t·∫£i...</p>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card">
            <div class="card-header bg-success text-white">
              <h5 class="mb-0">
                <i class="bi bi-people"></i> Ng∆∞·ªùi D√πng G·∫ßn ƒê√¢y
              </h5>
            </div>
            <div class="card-body" style="max-height: 400px; overflow-y: auto">
              <div id="recentUsersList">
                <p class="text-muted">ƒêang t·∫£i...</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Load statistics
      async function loadStatistics() {
        try {
          const response = await fetch("/api/admin/statistics");
          const result = await response.json();

          if (result.success) {
            const stats = result.data;

            document.getElementById("totalUsers").textContent =
              stats.totalUsers;
            document.getElementById("activeUsersText").textContent =
              stats.activeUsers + " ƒëang ho·∫°t ƒë·ªông";

            document.getElementById("activeAuctions").textContent =
              stats.activeAuctions;
            document.getElementById("totalAuctionsText").textContent =
              stats.totalAuctions + " t·ªïng";

            document.getElementById("endedAuctions").textContent =
              stats.endedAuctions;

            document.getElementById("totalValue").textContent =
              formatCurrency(stats.totalBidValue);
          }
        } catch (error) {
          console.error("Error loading statistics:", error);
        }
      }

      // Load active auctions
      async function loadActiveAuctions() {
        try {
          const response = await fetch("/api/auctions");
          const result = await response.json();

          if (result.success) {
            displayActiveAuctions(result.data);
          }
        } catch (error) {
          console.error("Error loading auctions:", error);
        }
      }

      function displayActiveAuctions(auctions) {
        const container = document.getElementById("activeAuctionsList");

        if (!auctions || auctions.length === 0) {
          container.innerHTML =
            '<p class="text-muted">Kh√¥ng c√≥ ƒë·∫•u gi√° n√†o ƒëang ho·∫°t ƒë·ªông</p>';
          return;
        }

        container.innerHTML = "";

        auctions.slice(0, 5).forEach((auction) => {
          const item = `
            <div class="border-bottom py-2">
              <div class="d-flex justify-content-between">
                <div>
                  <strong>${auction.title}</strong><br/>
                  <small class="text-muted">
                    Gi√°: ${formatCurrency(auction.currentPrice)} | 
                    Bids: ${auction.totalBids}
                  </small>
                </div>
                <div>
                  <a href="/auction/${auction.auctionId}" class="btn btn-sm btn-outline-primary">
                    Xem
                  </a>
                </div>
              </div>
            </div>
          `;
          container.innerHTML += item;
        });
      }

      // Load recent users
      async function loadRecentUsers() {
        try {
          const response = await fetch("/api/admin/users");
          const result = await response.json();

          if (result.success) {
            displayRecentUsers(result.data);
          }
        } catch (error) {
          console.error("Error loading users:", error);
        }
      }

      function displayRecentUsers(users) {
        const container = document.getElementById("recentUsersList");

        if (!users || users.length === 0) {
          container.innerHTML = '<p class="text-muted">Kh√¥ng c√≥ ng∆∞·ªùi d√πng n√†o</p>';
          return;
        }

        container.innerHTML = "";

        users.slice(0, 10).forEach((user) => {
          const statusBadge = user.isActive
            ? '<span class="badge bg-success">Active</span>'
            : '<span class="badge bg-danger">Banned</span>';

          const item = `
            <div class="border-bottom py-2">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <strong>${user.username}</strong>
                  ${statusBadge}
                  ${user.role === 'ADMIN' ? '<span class="badge bg-warning text-dark">ADMIN</span>' : ''}
                  <br/>
                  <small class="text-muted">
                    Email: ${user.email} | 
                    S·ªë d∆∞: ${formatCurrency(user.balance)}
                  </small>
                </div>
              </div>
            </div>
          `;
          container.innerHTML += item;
        });
      }

      function formatCurrency(amount) {
        return new Intl.NumberFormat("vi-VN").format(amount) + " VND";
      }

      function refreshData() {
        loadStatistics();
        loadActiveAuctions();
        loadRecentUsers();
        alert("ƒê√£ l√†m m·ªõi d·ªØ li·ªáu!");
      }

      // Initialize
      window.addEventListener("load", function () {
        loadStatistics();
        loadActiveAuctions();
        loadRecentUsers();
      });
    </script>
  </body>
</html>

